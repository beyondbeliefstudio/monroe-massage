---
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import Links from "@/components/Links.astro";

import { navData } from "@/data/navData";

import wordmark from "@/assets/mm-logo.png";
---

<!--=============== HEADER ===============-->
<header class="nav">
  <div class="nav__container">
    <div class="nav__logo">
      <a href="/" class="nav__logo-img">
        <Image src={wordmark} alt="Wordmark Logo" />
      </a>
      <a href="/" class="nav__logo-img__sticky">
        <Image src={wordmark} alt="Wordmark Logo" />
      </a>
    </div>

    <nav class="nav__links">
      {
        navData.map(i => {
          return (
            <Links variant="nav-link" href={i.href}>
              {i.title}
            </Links>
          );
        })
      }
      <Links variant="outline-light" href={"/get-a-quote"} id="navCTA">Get A Quote</Links>
    </nav>

    <!-- Hamburger -->
    <button class="hamburger" id="hamburgerBtn" aria-label="Toggle Menu">
      <div class="circle"></div>
      <span class="line top"></span>
      <span class="line middle"></span>
      <span class="line bottom"></span>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div class="nav__mobile" id="mobileNav">
    {
      navData.map(i => {
        return (
          <Links variant="nav-link" href={i.href}>
            {i.title}
          </Links>
        );
      })
    }
    <Links variant="primary" href={"/get-a-quote"}>Get A Quote</Links>
  </div>

  <!-- Mobile Menu Overlay -->
  <div class="nav__overlay" id="navOverlay"></div>
</header>

<style lang="scss">
  .nav {
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1000;
    border-bottom: 1px solid var(--light-100);

    &:not(.nav.scrolled) {
      .nav-link {
        color: var(--light-100);
      }
    }

    &__container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: var(--container--main--md);
      padding: 0.5rem;
      margin: 0rem auto;
      width: 100%;
      gap: 3rem;
      position: relative;
      z-index: 10;
      background-color: transparent;
    }

    &__logo-img {
      display: block;
      height: 100%;
      line-height: 0;

      svg,
      img {
        height: 60px !important;
        width: auto !important;
        filter: invert(1);
      }
    }

    &__logo-img__sticky {
      display: none;
      height: 100%;
      line-height: 0;

      svg,
      img {
        height: 60px !important;
        width: auto !important;
      }
    }

    &__links {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    &.scrolled {
      background-color: var(--light-200--transparency);

      .nav__logo-img {
        display: none;
      }

      .nav__logo-img__sticky {
        display: block;
      }

      .nav__container {
        width: 100%;
        // padding: 0.5rem 0.5rem 0.5rem 1rem;
      }
    }

    /* Mobile Nav */
    &__mobile {
      display: none;
      position: absolute;
      background-color: #ffffffd1;
      backdrop-filter: blur(0.35rem);
      border-radius: var(--border-radius-small);
      outline: 1px solid var(--light-100);
      width: 100%;
      padding: 0.5rem;
      flex-direction: column;
      gap: 1rem;
      justify-content: center;
      z-index: 1;
      transform: translateY(100%);
      height: fit-content;
      top: 100%;
      max-width: var(--container--main--md);
      left: var(--site--margin);
      right: var(--site--margin);
    }

    &__mobile a:not(.btn) {
      color: var(--dark-900);
      text-align: left;
      text-decoration: none;
      position: relative;
    }

    &__mobile .btn {
      width: fit-content;
      margin: 0;
    }

    /* Open State */
    &__mobile.open {
      transform: translateY(0);
      display: flex !important;
    }

    /* Mobile Menu Overlay */
    &__overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(2px);
      z-index: 0;
      opacity: 0;
      visibility: hidden;
      transition:
        opacity 0.3s ease,
        visibility 0.3s ease;
      pointer-events: none;
    }

    &__overlay.active {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }
  }

  /* Hamburger Button */
  .hamburger {
    position: relative;
    width: 48px;
    height: 48px;
    border: none;
    background: none;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  .circle {
    position: absolute;
    width: 48px;
    height: 48px;
    background-color: var(--brand-primary); /* Customize */
    border-radius: 5px;
    z-index: -1;
    transform: scale(1);
    transition: background-color 0.3s ease;
  }

  .line {
    position: absolute;
    width: 24px;
    height: 3px;
    background-color: var(--dark-900);
    border-radius: 2px;
    transition: background-color 0.3s ease;
  }

  .line.top {
    top: 14px;
  }

  .line.middle {
    top: 22px;
  }

  .line.bottom {
    top: 30px;
  }

  body.menu-open {
    overflow: hidden;
  }

  /* Responsive Behavior */
  @media (max-width: 1010px) {
    .nav {
      &__container {
        margin: 1rem auto;
      }

      &__logo-img {
        svg,
        img {
          height: 70px;
          width: fit-content;
        }
      }

      &__links {
        display: none;
      }
    }

    .nav.scrolled {
      .nav__container {
        width: 100%;
        padding-left: 0.5rem;
      }
    }

    .hamburger {
      display: flex;
    }
  }
</style>

<script>
  import gsap from "gsap";

  // NAV
  const hamburgerBtn = document.getElementById("hamburgerBtn") as HTMLElement;
  const mobileNav = document.getElementById("mobileNav") as HTMLElement;
  const navOverlay = document.getElementById("navOverlay") as HTMLElement;
  const topLine = document.querySelector(".line.top");
  const middleLine = document.querySelector(".line.middle");
  const bottomLine = document.querySelector(".line.bottom");
  const circle = document.querySelector(".circle");
  let isOpen = false;

  const tl = gsap.timeline({ paused: true });

  function hideNav(): void {
    gsap.set(mobileNav, { display: "none" });
  }

  tl.to(
    middleLine,
    {
      duration: 0.2,
      opacity: 0,
      ease: "power1.inOut",
    },
    0
  )
    .to(
      topLine,
      {
        duration: 0.3,
        rotate: 45,
        y: 8,
        ease: "power2.inOut",
      },
      0
    )
    .to(
      bottomLine,
      {
        duration: 0.3,
        rotate: -45,
        y: -8,
        ease: "power2.inOut",
      },
      0
    )
    .to(
      circle,
      {
        duration: 0.3,
        scale: 1,
        ease: "power2.inOut",
      },
      0
    );

  hamburgerBtn.classList.remove("open");

  hamburgerBtn.addEventListener("click", () => {
    mobileNav.classList.toggle("open");
    navOverlay.classList.toggle("active");
    document.body.classList.toggle("menu-open");
    hamburgerBtn.classList.toggle("open");

    if (!isOpen) {
      // Reveal and animate in
      gsap.set(mobileNav, { display: "flex", y: "-100%" });
      gsap.to(mobileNav, { duration: 0.5, y: "0%", ease: "power2.out" });
      isOpen = true;
      tl.play();
    } else {
      // Animate out and hide
      gsap.to(mobileNav, {
        duration: 0.4,
        y: "-100%",
        ease: "power2.in",
        onComplete: hideNav,
      });
      tl.reverse();
      isOpen = false;
    }
  });

  // Close menu when clicking overlay
  navOverlay.addEventListener("click", () => {
    if (isOpen) {
      mobileNav.classList.remove("open");
      navOverlay.classList.remove("active");
      document.body.classList.remove("menu-open");
      hamburgerBtn.classList.remove("open");

      gsap.to(mobileNav, {
        duration: 0.4,
        y: "-100%",
        ease: "power2.in",
        onComplete: hideNav,
      });
      tl.reverse();
      isOpen = false;
    }
  });

  window.addEventListener("scroll", () => {
    const header = document.querySelector(".nav") as HTMLElement;
    const navCTA = document.getElementById("navCTA") as HTMLElement;

    if (window.scrollY > 50) {
      header.classList.add("scrolled");
      if (navCTA) {
        navCTA.classList.remove("outline-light");
        navCTA.classList.add("primary");
      }
    } else {
      header.classList.remove("scrolled");
      if (navCTA) {
        navCTA.classList.remove("primary");
        navCTA.classList.add("outline-light");
      }
    }
  });
</script>
